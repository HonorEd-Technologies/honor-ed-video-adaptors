<!DOCTYPE html>
<html>
<head>
    <script src='main.js'></script>
</head>
<body style="margin: 0px; background-color: black;">
    <div id='player-1'></div>
    <script src-='https://www.youtube.com/iframe_api'></script>
    <script>
        let search = window.location.search
        let urlParams = new URLSearchParams(search)
        let videoId = urlParams.get("videoId")
        let videoProvider = urlParams.get("provider")

        window.addEventListener('load', (event) => { 
            if (!videoId || !videoProvider) {
                document.getElementById('player-1').innerText = "Please pass in a video id and a provider type (e.g. 'youtube')"
            } else {
                let config = { 
                    provider: videoProvider,
                    height: document.documentElement.clientHeight,
                    width: document.documentElement.clientWidth,
                    videoId,
                    autoplay: false,
                    controls: false,
                    fullscreenEnabled: false,
                    playsInline: true
                }

                const player = new HonorPlayer('player-1', config)
                window.HonorPlayer = player

                player.onReady(() => { 
                    if (window.webkit && window.webkit.messageHandlers && window.webkit.messageHandlers.playerReady) { 
                        window.webkit.messageHandlers.playerReady.postMessage({})
                    }
                })

                player.onStateChanged((state) => { 
                    if (window.webkit && window.webkit.messageHandlers && window.webkit.messageHandlers.playerStateChanged) { 
                        window.webkit.messageHandlers.playerStateChanged.postMessage({ state })
                    }
                })

                player.onError((error) => { 
                    if (window.webkit && window.webkit.messageHandlers && window.webkit.messageHandlers.playerError) { 
                        window.webkit.messageHandlers.playerError.postMessage({ error })
                    }
                })

                player.onCurrentTimeChanged((time) => { 
                    if (window.webkit && window.webkit.messageHandlers && window.webkit.messageHandlers.currentTimeChanged) { 
                        window.webkit.messageHandlers.currentTimeChanged.postMessage({ time })
                    }
                })
            }
        })

        window.addEventListener("resize", (event) => {
          const newWidth = document.documentElement.clientWidth
          const newHeight = document.documentElement.clientHeight
          console.log(`resize width: ${newWidth}, height: ${newHeight}`)
          if (window.HonorPlayer) { 
            window.HonorPlayer.setSize(newWidth, newHeight)
          }
        })
    </script>
</body>
</html>